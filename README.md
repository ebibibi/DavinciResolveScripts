# DaVinci Resolve 自動動画編集スクリプト

## 概要
このプロジェクトは、DaVinci Resolveでの動画編集ワークフローを自動化するためのPythonスクリプトです。
無音部分の自動カット、エンディング動画の自動追加、タイムライン統合などを自動実行します。

**2つのバージョンを提供:**
- **有償版用**: テンプレートプロジェクトからの自動プロジェクト作成機能付き
- **無料版用**: 既存プロジェクトでの動作（従来版）

## 主な機能

### 共通機能
1. OBS録画した最新の`.mkv`ファイルを自動検出
2. `auto-editor`を使用して無音部分をカットし、XMLファイルを生成
3. 生成されたXMLファイルをDaVinci Resolveにインポート
4. タイムラインにエンディング動画を自動追加
5. メインタイムラインに新しく作成したタイムラインの内容を挿入

### 有償版限定機能
- Davinci Resolve自体の起動
- テンプレート.drpからの自動プロジェクト作成
- リトライ機能付きクリップ追加（安定性向上）
- クロスプラットフォーム対応（Windows/Mac/Linux）

## ファイル構成

```
DavinciResolveScripts/
├── README.md
├── 有償版用スクリプト/
│   ├── auto_video_editor.py （メインスクリプト）
│   ├── run_auto_video_editor.bat （実行用バッチファイル）
│   ├── create_desktop_shortcut.bat （ショートカット作成）
│   └── テンプレート.drp （プロジェクトテンプレート）
└── 無料版用スクリプト/
    ├── auto_video_editor.py （メインスクリプト）
    └── テンプレート.drp （プロジェクトテンプレート）
```

## 前提条件

### 必須環境
- DaVinci Resolve 17以上（有償版の場合はDaVinci Resolve Studio推奨）
- Python 3.6以上
- auto-editor（`pip install auto-editor`）

### フォルダ構造
以下のフォルダ構造が必要です：
- OBS録画データが保存されているフォルダ
- エンディング動画が保存されているフォルダ

## 使用方法

### 有償版の場合

#### 方法1: バッチファイル実行（推奨）
1. `有償版用スクリプト\run_auto_video_editor.bat` をダブルクリック
2. 自動的に環境チェックが実行され、スクリプトが起動します

#### 方法2: デスクトップショートカット作成
1. `有償版用スクリプト\create_desktop_shortcut.bat` をダブルクリック
2. デスクトップにショートカットが作成されます
3. 作成されたショートカットをダブルクリックして実行

#### 方法3: コマンドライン実行
1. DaVinci Resolve Studioを起動
2. コマンドラインまたはターミナルで以下を実行：
   ```bash
   cd 有償版用スクリプト
   python auto_video_editor.py
   ```

### 無料版の場合
1. DaVinci Resolveを起動し、プロジェクトとタイムラインを開く
2. DaVinci ResolveのスクリプトコンソールでPy3を選択
3. `auto_video_editor.py`の内容をコピー＆ペーストして実行

## 動作の仕組み

### 1. auto-editorの実行
- 指定ディレクトリ内の最新の`.mkv`ファイルを自動検出
- 無音部分をカットしてResolve用XMLファイルを生成

### 2. プロジェクト準備（有償版のみ）
- テンプレート.drpから新規プロジェクトを自動作成
- ユニークなプロジェクト名を自動生成

### 3. XMLファイルの処理
- 最新のXMLファイル（`.fcpxml`または`.xml`）を自動検出
- DaVinci Resolveにインポートして新しいタイムラインを作成

### 4. エンディング動画の追加
- 指定したエンディング動画をメディアプールにインポート
- タイムラインの最後に自動追加

### 5. タイムラインの統合
- オープニングクリップ（`01_EBI_CHAN_OP`）の位置を自動検出
- オープニング後に新しいコンテンツを挿入
- 編集ポジションをタイムライン先頭に移動

## カスタマイズ

スクリプト内の以下のパスを環境に合わせて変更してください：

### 1. 作業ディレクトリ（OBS録画データの保存場所）
```python
working_dir = r'C:\Users\masah\OneDrive - hccjp (1)\Youtube動画作成場所\!OBS録画'
```

### 2. XMLフォルダの候補パス
```python
xml_folder_paths = [
    r'C:\OneDrive\OneDrive - hccjp\Youtube動画作成場所\!OBS録画',
    r'C:\Users\masah\OneDrive - hccjp (1)\Youtube動画作成場所\!OBS録画'
]
```

### 3. エンディング動画のパス
```python
ending_video_paths = [
    r'C:\Users\masah\OneDrive - hccjp (1)\Youtube動画作成場所\!動画素材\03_EBI_CHAN_IN.mov',
    r'C:\OneDrive\OneDrive - hccjp\Youtube動画作成場所\!動画素材\03_EBI_CHAN_IN.mov'
]
```

## 注意事項

### 有償版
- DaVinci Resolve Studioが推奨（Python APIの完全サポート）
- テンプレート.drpファイルが同一フォルダに必要
- 自動的にプロジェクトが作成されるため、手動でのプロジェクト準備は不要

### 無料版
- 実行前にDaVinci Resolveでプロジェクトとタイムラインを開く必要あり
- スクリプトコンソールからの実行が必要

### 共通
- 指定したパスがすべて存在することを確認
- オープニングクリップは名前に「01_EBI_CHAN_OP」を含む必要あり
- デバッグ情報が詳細に出力されます

## トラブルシューティング

### よくあるエラーと対処法

#### 「指定ディレクトリに mkv ファイルが見つかりません」
- 作業ディレクトリに`.mkv`ファイルがあることを確認
- ファイルパスが正しいことを確認

#### 「テンプレートインポート失敗」（有償版）
- テンプレート.drpファイルがスクリプトと同じフォルダにあることを確認
- DaVinci Resolve Studioを使用していることを確認

#### 「タイムラインのインポートに失敗しました」
- XMLファイルの形式が正しいか確認
- auto-editorが正常に実行されているか確認

#### 「クリップの挿入に失敗しました」
- リトライ機能が自動実行されます（有償版）
- DaVinci Resolveの状態を確認し、必要に応じて再実行

## 技術仕様

### 有償版の追加機能
- **リトライ機能**: `'NoneType' object is not callable`エラーに対する自動リトライ
- **クロスプラットフォーム対応**: Windows、Mac、Linux自動対応
- **オブジェクト再取得**: 安定性向上のための自動オブジェクト更新
- **詳細ログ**: トラブルシューティング用の詳細情報出力

### パフォーマンス
- 大量クリップ（300+）の処理に対応
- メモリ効率的な処理方式
- エラー発生時の自動復旧機能

## ライセンス
このプロジェクトは個人利用・商用利用ともに自由にご利用いただけます。